<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PAR Brink Dashboard - Local Test</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #2c3e50;
        text-align: center;
      }
      .test-section {
        margin: 20px 0;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: #f9f9f9;
      }
      button {
        background: #3498db;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #2980b9;
      }
      .result {
        margin-top: 15px;
        padding: 15px;
        border-radius: 5px;
        white-space: pre-wrap;
        font-family: monospace;
        font-size: 12px;
      }
      .success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
      }
      .info {
        background: #d1ecf1;
        border: 1px solid #bee5eb;
        color: #0c5460;
      }
      .status {
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ PAR Brink Dashboard Function - Local Test</h1>

      <div class="status info">
        <strong>Purpose:</strong> Test the parBrinkDashboard function locally
        before deployment
      </div>

      <div class="test-section">
        <h3>Environment Selection</h3>
        <button onclick="setEnvironment('local')">
          üè† Test Local (localhost:7071)
        </button>
        <button onclick="setEnvironment('azure')">
          ‚òÅÔ∏è Test Azure (Production)
        </button>
        <div id="env-status" class="result info"></div>
      </div>

      <div class="test-section">
        <h3>Test 1: Health Check</h3>
        <button onclick="testHealth()">üè• Test Health Endpoint</button>
        <div id="health-result" class="result"></div>
      </div>

      <div class="test-section">
        <h3>Test 2: PAR Brink Configurations</h3>
        <button onclick="testConfigurations()">
          üîß Test Configurations Endpoint
        </button>
        <div id="config-result" class="result"></div>
      </div>

      <div class="test-section">
        <h3>Test 3: PAR Brink Dashboard (Main Test)</h3>
        <button onclick="testDashboard()">üìä Test Dashboard Endpoint</button>
        <div id="dashboard-result" class="result"></div>
      </div>

      <div class="test-section">
        <h3>üìä Test Summary</h3>
        <div id="summary" class="result info">
          Run tests above to see summary
        </div>
      </div>
    </div>

    <script>
      let baseUrl = "";
      const testResults = {
        health: null,
        config: null,
        dashboard: null,
      };

      function setEnvironment(env) {
        if (env === "local") {
          baseUrl = "http://localhost:7071/api";
          document.getElementById("env-status").innerHTML =
            "üè† Testing LOCAL environment: " + baseUrl;
          document.getElementById("env-status").className = "result info";
        } else {
          baseUrl =
            "https://ukg-sync-backend-5rrqlcuxyzlvy.azurewebsites.net/api";
          document.getElementById("env-status").innerHTML =
            "‚òÅÔ∏è Testing AZURE environment: " + baseUrl;
          document.getElementById("env-status").className = "result info";
        }
      }

      async function testHealth() {
        if (!baseUrl) {
          alert("Please select an environment first!");
          return;
        }

        const resultDiv = document.getElementById("health-result");
        resultDiv.innerHTML = "‚è≥ Testing health endpoint...";
        resultDiv.className = "result info";

        try {
          const response = await fetch(`${baseUrl}/health`);
          const data = await response.json();

          testResults.health = response.ok;
          resultDiv.innerHTML = `‚úÖ Status: ${
            response.status
          }\n${JSON.stringify(data, null, 2)}`;
          resultDiv.className = "result success";
        } catch (error) {
          testResults.health = false;
          resultDiv.innerHTML = `‚ùå Error: ${error.message}`;
          resultDiv.className = "result error";
        }
        updateSummary();
      }

      async function testConfigurations() {
        if (!baseUrl) {
          alert("Please select an environment first!");
          return;
        }

        const resultDiv = document.getElementById("config-result");
        resultDiv.innerHTML = "‚è≥ Testing configurations endpoint...";
        resultDiv.className = "result info";

        try {
          const response = await fetch(`${baseUrl}/par-brink/configurations`);
          const data = await response.json();

          testResults.config = response.ok;
          resultDiv.innerHTML = `‚úÖ Status: ${
            response.status
          }\nLocations found: ${
            data.data?.locations?.length || 0
          }\n${JSON.stringify(data, null, 2)}`;
          resultDiv.className = "result success";
        } catch (error) {
          testResults.config = false;
          resultDiv.innerHTML = `‚ùå Error: ${error.message}`;
          resultDiv.className = "result error";
        }
        updateSummary();
      }

      async function testDashboard() {
        if (!baseUrl) {
          alert("Please select an environment first!");
          return;
        }

        const resultDiv = document.getElementById("dashboard-result");
        resultDiv.innerHTML = "‚è≥ Testing dashboard endpoint...";
        resultDiv.className = "result info";

        // Test payload matching frontend
        const payload = {
          locationId: "1",
          businessDate: "2025-07-27",
        };

        try {
          const response = await fetch(`${baseUrl}/par-brink/dashboard`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          });

          if (response.ok) {
            const data = await response.json();
            testResults.dashboard = true;
            resultDiv.innerHTML = `‚úÖ Status: ${
              response.status
            }\n${JSON.stringify(data, null, 2)}`;
            resultDiv.className = "result success";
          } else {
            const errorText = await response.text();
            testResults.dashboard = false;
            resultDiv.innerHTML = `‚ùå Status: ${response.status}\nError: ${errorText}`;
            resultDiv.className = "result error";
          }
        } catch (error) {
          testResults.dashboard = false;
          resultDiv.innerHTML = `‚ùå Error: ${error.message}`;
          resultDiv.className = "result error";
        }
        updateSummary();
      }

      function updateSummary() {
        const summaryDiv = document.getElementById("summary");
        const total = Object.values(testResults).filter(
          (r) => r !== null
        ).length;
        const passed = Object.values(testResults).filter(
          (r) => r === true
        ).length;

        let summary = `Tests Run: ${total}/3\nPassed: ${passed}\nFailed: ${
          total - passed
        }\n\n`;
        summary += `Health: ${
          testResults.health === null
            ? "‚è≥ Not run"
            : testResults.health
            ? "‚úÖ Pass"
            : "‚ùå Fail"
        }\n`;
        summary += `Config: ${
          testResults.config === null
            ? "‚è≥ Not run"
            : testResults.config
            ? "‚úÖ Pass"
            : "‚ùå Fail"
        }\n`;
        summary += `Dashboard: ${
          testResults.dashboard === null
            ? "‚è≥ Not run"
            : testResults.dashboard
            ? "‚úÖ Pass"
            : "‚ùå Fail"
        }\n`;

        summaryDiv.innerHTML = summary;
        summaryDiv.className =
          total === 3 && passed === 3 ? "result success" : "result info";
      }

      // Initialize
      setEnvironment("local");
    </script>
  </body>
</html>
